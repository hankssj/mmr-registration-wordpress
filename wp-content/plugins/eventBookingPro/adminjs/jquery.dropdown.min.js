(function(B,A,C){B.DropDown=function(D,E){this.$el=B(E);this._init(D)};B.DropDown.defaults={speed:300,easing:"ease",gutter:0,stack:true,delay:0,random:false,rotated:false,slidingIn:false,onOptionSelect:function(D){return false}};B.DropDown.prototype={_init:function(D){this.options=B.extend(true,{},B.DropDown.defaults,D);this._layout();this._initEvents()},_layout:function(){var D=this;this.minZIndex=1000;var G=this._transformSelect();this.opts=this.listopts.children("li");this.optsCount=this.opts.length;this.size={width:this.dd.width(),height:this.dd.height()};var H=this.$el.attr("name"),F=this.$el.attr("id"),E=H!==C?H:F!==C?F:"cd-dropdown-"+(new Date()).getTime();this.inputEl=B('<input type="hidden" name="'+E+'" value="'+G+'"></input>').insertAfter(this.selectlabel);this.selectlabel.css("z-index",this.minZIndex+this.optsCount);this._positionOpts();if(Modernizr.csstransitions){setTimeout(function(){D.opts.css("transition","all "+D.options.speed+"ms "+D.options.easing)},25)}},_transformSelect:function(){var F="",D="",E=-1;this.$el.children("option").each(function(){var J=B(this),L=isNaN(J.attr("value"))?J.attr("value"):Number(J.attr("value")),M=isNaN(J.attr("data-cost"))?J.attr("data-cost"):Number(J.attr("data-cost")),K=isNaN(J.attr("data-allowed"))?J.attr("data-allowed"):Number(J.attr("data-allowed")),H=J.attr("class"),I=J.attr("selected"),G=J.text();if(L!==-1){F+=H!==C?'<li data-value="'+L+'" data-allowed="'+K+'" data-cost="'+M+'"><span class="'+H+'">'+G+"</span></li>":'<li data-value="'+L+'" data-allowed="'+K+'" data-cost="'+M+'"><span>'+G+"</span></li>"}if(I){D=G;E=L}});this.listopts=B("<ul/>").append(F);this.selectlabel=B("<span/>").append(D);this.dd=B('<div class="cd-dropdown"/>').append(this.selectlabel,this.listopts).insertAfter(this.$el);this.$el.remove();return E},_positionOpts:function(E){var D=this;this.listopts.css("height","auto");this.opts.each(function(F){B(this).css({zIndex:D.minZIndex+D.optsCount-1-F,top:D.options.slidingIn?(F+1)*(D.size.height+D.options.gutter):0,left:0,marginLeft:D.options.slidingIn?F%2===0?D.options.slidingIn:-D.options.slidingIn:0,opacity:D.options.slidingIn?0:1,transform:"none"})});if(!this.options.slidingIn){this.opts.eq(this.optsCount-1).css({top:this.options.stack?9:0,left:this.options.stack?4:0,width:this.options.stack?this.size.width-8:this.size.width,transform:"none"}).end().eq(this.optsCount-2).css({top:this.options.stack?6:0,left:this.options.stack?2:0,width:this.options.stack?this.size.width-4:this.size.width,transform:"none"}).end().eq(this.optsCount-3).css({top:this.options.stack?3:0,left:0,transform:"none"})}},_initEvents:function(){var D=this;this.selectlabel.on("mousedown.dropdown",function(E){D.opened?D.close():D.open();return false});this.opts.on("click.dropdown",function(){if(D.opened){var E=B(this);D.options.onOptionSelect(E);D.inputEl.val(E.data("value"));D.selectlabel.html(E.html());D.close()}})},open:function(){var D=this;var E;this.dd.toggleClass("cd-active");this.listopts.css("height",(this.optsCount+1)*(this.size.height+this.options.gutter));this.opts.each(function(F){E=(D.size.height>40)?D.size.height:40;B(this).css({opacity:1,top:D.options.rotated?E+D.options.gutter:(F+1)*(E+D.options.gutter),left:D.options.random?Math.floor(Math.random()*11-5):0,marginLeft:0,transform:D.options.random?"rotate("+Math.floor(Math.random()*11-5)+"deg)":D.options.rotated?D.options.rotated==="right"?"rotate(-"+(F*5)+"deg)":"rotate("+(F*5)+"deg)":"none",transitionDelay:D.options.delay&&Modernizr.csstransitions?D.options.slidingIn?(F*D.options.delay)+"ms":((D.optsCount-1-F)*D.options.delay)+"ms":0})});this.opened=true},close:function(){var D=this;this.dd.toggleClass("cd-active");if(this.options.delay&&Modernizr.csstransitions){this.opts.each(function(E){B(this).css({"transition-delay":D.options.slidingIn?((D.optsCount-1-E)*D.options.delay)+"ms":(E*D.options.delay)+"ms"})})}this._positionOpts(true);this.opened=false}};B.fn.dropdownMoe=function(F){var D=B.data(this,"dropdownMoe");if(typeof F==="string"){var E=Array.prototype.slice.call(arguments,1);this.each(function(){D[F].apply(D,E)})}else{this.each(function(){D?D._init():D=B.data(this,"dropdownMoe",new B.DropDown(F,this))})}return D}})(jQuery,window);